# CLAUDE.md Schema Rules - Single Source of Truth
# This file defines all validation rules for CLAUDE.md files.
# Rules are consumed by:
#   - Rust core engine (build-time code generation via build.rs)
#   - Documentation (templates/claude-md-schema.md)
#   - Schema-validate skill (claude-md-core validate-schema CLI)

version: "1.0.0"
description: "CLAUDE.md 스키마 검증 규칙 - Single Source of Truth"

sections:
  purpose:
    name: "Purpose"
    required: true
    condition: "always"
    allow_none: false
    description: "디렉토리의 책임을 1-2문장으로 명시"

  exports:
    name: "Exports"
    required: true
    condition: "always"
    allow_none: true
    description: "모듈의 public interface를 시그니처 레벨로"
    validation:
      pattern: "^[A-Za-z_][A-Za-z0-9_]*\\s*\\([^)]*\\).*"
      description: "함수 시그니처 형식: Name(params): ReturnType"

  behavior:
    name: "Behavior"
    required: true
    condition: "always"
    allow_none: true
    description: "동작을 시나리오 레벨 (input → output)로 명시"
    validation:
      pattern: ".+\\s*[→->].+"
      description: "시나리오 형식: input → output"

  contract:
    name: "Contract"
    required: true
    condition: "always"
    allow_none: true
    description: "함수별 사전조건, 사후조건, 불변식"
    subsections:
      - preconditions
      - postconditions
      - throws
      - invariants

  protocol:
    name: "Protocol"
    required: true
    condition: "always"
    allow_none: true
    description: "상태 전이나 호출 순서"
    subsections:
      - state_machine
      - lifecycle

  domain_context:
    name: "Domain Context"
    required: true
    condition: "always"
    allow_none: true
    description: "compile 시 동일한 코드 재현을 보장하기 위한 맥락 (결정 근거, 제약 조건, 호환성 요구)"
    subsections:
      - decision_rationale
      - constraints
      - compatibility

  structure:
    name: "Structure"
    required: false
    condition: "has_subdirs_or_files"
    allow_none: false
    description: "하위 디렉토리나 파일이 있는 경우 구조 설명"

  dependencies:
    name: "Dependencies"
    required: false
    condition: "has_external_or_internal_deps"
    allow_none: false
    description: "외부/내부 의존성 목록"

  constraints:
    name: "Constraints"
    required: false
    condition: "has_constraints"
    allow_none: false
    description: "지켜야 할 규칙이나 제약사항"

  project_convention:
    name: "Project Convention"
    required: false
    condition: "is_project_or_module_root"
    allow_none: false
    description: "프로젝트 수준 아키텍처/구조 규칙"
    required_subsections:
      - "Project Structure"
      - "Module Boundaries"
      - "Naming Conventions"

  code_convention:
    name: "Code Convention"
    required: false
    condition: "is_project_or_module_root"
    allow_none: false
    description: "소스코드 수준 코딩 규칙"
    required_subsections:
      - "Language & Runtime"
      - "Code Style"
      - "Naming Rules"

convention_rules:
  module_root_markers:
    - "package.json"
    - "Cargo.toml"
    - "go.mod"
    - "pyproject.toml"
    - "build.gradle"
    - "build.gradle.kts"
    - "pom.xml"
    - "setup.py"
    - "CMakeLists.txt"

reference_rules:
  forbidden_patterns:
    - pattern: "\\.\\./"
      description: "부모 디렉토리 참조 금지"
    - pattern: "\\.\\.\\\\/"
      description: "부모 디렉토리 참조 금지 (Windows)"

  allowed_patterns:
    - pattern: "^\\.\\/|^\\.\\\\/"
      description: "자식 디렉토리 참조 허용"

none_marker:
  values:
    - "None"
    - "none"
    - "N/A"
    - "n/a"
  description: "명시적으로 해당 섹션이 비어있음을 표시하는 값"
